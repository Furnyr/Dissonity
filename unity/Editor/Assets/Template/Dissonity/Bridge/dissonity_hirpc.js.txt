(()=>{"use strict";var t,e,s={d:(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(t,'__esModule',{value:!0})}},i={};function n(t){console.log(`%c[DissonityHiRpc]%c ${t}`,"color:#8177f6;font-weight: bold;","color:initial;")}function a(t){console.error(`%c[DissonityHiRpc]%c ${t}`,"color:#8177f6;font-weight: bold;","color:initial;")}s.r(i),s.d(i,{default:()=>E}),function(t){t[t.Unfunctional=0]="Unfunctional",t[t.OutsideDiscord=1]="OutsideDiscord",t[t.Errored=2]="Errored",t[t.Loading=3]="Loading",t[t.Stable=4]="Stable"}(t||(t={})),function(t){t[t.Handshake=0]="Handshake",t[t.Frame=1]="Frame",t[t.Close=2]="Close",t[t.Hello=3]="Hello"}(e||(e={}));const r=Object.freeze({DISPATCH:"DISPATCH",AUTHORIZE:"AUTHORIZE",AUTHENTICATE:"AUTHENTICATE"}),o=Object.freeze({READY:"READY",ERROR:"ERROR"}),c=Object.freeze({MOBILE:"mobile",DESKTOP:"desktop"}),h="0.5.0",d="dissonity",l="1.9.0";class p{#t;#e=!1;#s=()=>null;#i=()=>null;constructor(t){this.#t=t}async generateHash(t=!1){if(t&&null!=this.#i())return this.#i();if(!t&&null!=this.#s())return this.#s();const e=window.crypto.getRandomValues(new Uint8Array(16)),s=(new TextEncoder).encode(Date.now().toString()),i=new Uint8Array(e.length+s.length);i.set(s),i.set(e,s.length);const n=await window.crypto.subtle.digest("SHA-256",i),a=Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("");return t?this.#i=()=>a:this.#s=()=>a,a}async requestHash(){return this.#e||this.#t.accessCount>=this.#t.maxAccessCount?null:(this.#t.accessCount++,await this.generateHash())}compareHashes(t,e){if(t.length!=e.length)return!1;let s=0;for(let i=0;i<t.length;i++)s|=t.charCodeAt(i)^e.charCodeAt(i);return 0==s}verifyHash(t){return this.verifyAccessHash(t)||this.verifyAppHash(t)}verifyAccessHash(t){return null!=this.#s()&&this.compareHashes(t,this.#s())}verifyAppHash(t){return null!=this.#i()&&this.compareHashes(t,this.#i())}lock(){this.#e=!0}}class u{constructor(){this.maxAccessCount=1,this.accessCount=0,this.appSender=null,this.appSenderPromise=null,this.dispatchAppSender=null,this.appListeners=new Map,this.loaded=!1,this.stateCode=t.Loading,this.readyPromise=null,this.dispatchReady=null,this.authPromise=null,this.dispatchAuth=null,this.getMultiEvent=()=>({ready:"",authorize:"",authenticate:"",response:""})}}class g{formatPrice(t,e="en-US"){const{amount:s,currency:i}=t;return Intl.NumberFormat(e,{style:'currency',currency:i}).format(function(t,e){const s=f[e];if(null==s)return console.warn(`Unexpected currency ${e}`),t;return t/10**s}(s,i))}patchUrlMappings(t,{patchFetch:e=!0,patchWebSocket:s=!0,patchXhr:i=!0,patchSrcAttributes:n=!1}={}){if('undefined'!=typeof window){if(e){const e=window.fetch;window.fetch=function(s,i){if(s instanceof Request){const n=y({url:R(s.url),mappings:t}),{url:a,...r}=i??{};return Object.keys(Request.prototype).forEach((t=>{if('url'!==t)try{r[t]=s[t]}catch(e){console.warn(`Remapping fetch request key "${t}" failed`,e)}})),new Promise(((t,i)=>{try{s.blob().then((i=>{'HEAD'!==s.method.toUpperCase()&&'GET'!==s.method.toUpperCase()&&i.size>0&&(r.body=i),t(e(new Request(n,r)))}))}catch(t){i(t)}}))}const n=y({url:s instanceof URL?s:R(s),mappings:t});return e(n,i)}}if(s){class e extends WebSocket{constructor(e,s){super(y({url:e instanceof URL?e:R(e),mappings:t}),s)}}window.WebSocket=e}if(i){const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(s,i,n,a,r){const o=y({url:R(i),mappings:t});e.apply(this,[s,o,n,a,r])}}if(n){const e={attributeFilter:['src'],childList:!0,subtree:!0};new MutationObserver((function(e){for(const s of e)'attributes'===s.type&&'src'===s.attributeName?D(s.target,t):'childList'===s.type&&s.addedNodes.forEach((e=>{D(e,t),A(e,t)}))})).observe(window.document,e),window.document.querySelectorAll('[src]').forEach((e=>{D(e,t)}))}}}}var m;!function(t){t.AED="aed",t.AFN="afn",t.ALL="all",t.AMD="amd",t.ANG="ang",t.AOA="aoa",t.ARS="ars",t.AUD="aud",t.AWG="awg",t.AZN="azn",t.BAM="bam",t.BBD="bbd",t.BDT="bdt",t.BGN="bgn",t.BHD="bhd",t.BIF="bif",t.BMD="bmd",t.BND="bnd",t.BOB="bob",t.BOV="bov",t.BRL="brl",t.BSD="bsd",t.BTN="btn",t.BWP="bwp",t.BYN="byn",t.BYR="byr",t.BZD="bzd",t.CAD="cad",t.CDF="cdf",t.CHE="che",t.CHF="chf",t.CHW="chw",t.CLF="clf",t.CLP="clp",t.CNY="cny",t.COP="cop",t.COU="cou",t.CRC="crc",t.CUC="cuc",t.CUP="cup",t.CVE="cve",t.CZK="czk",t.DJF="djf",t.DKK="dkk",t.DOP="dop",t.DZD="dzd",t.EGP="egp",t.ERN="ern",t.ETB="etb",t.EUR="eur",t.FJD="fjd",t.FKP="fkp",t.GBP="gbp",t.GEL="gel",t.GHS="ghs",t.GIP="gip",t.GMD="gmd",t.GNF="gnf",t.GTQ="gtq",t.GYD="gyd",t.HKD="hkd",t.HNL="hnl",t.HRK="hrk",t.HTG="htg",t.HUF="huf",t.IDR="idr",t.ILS="ils",t.INR="inr",t.IQD="iqd",t.IRR="irr",t.ISK="isk",t.JMD="jmd",t.JOD="jod",t.JPY="jpy",t.KES="kes",t.KGS="kgs",t.KHR="khr",t.KMF="kmf",t.KPW="kpw",t.KRW="krw",t.KWD="kwd",t.KYD="kyd",t.KZT="kzt",t.LAK="lak",t.LBP="lbp",t.LKR="lkr",t.LRD="lrd",t.LSL="lsl",t.LTL="ltl",t.LVL="lvl",t.LYD="lyd",t.MAD="mad",t.MDL="mdl",t.MGA="mga",t.MKD="mkd",t.MMK="mmk",t.MNT="mnt",t.MOP="mop",t.MRO="mro",t.MUR="mur",t.MVR="mvr",t.MWK="mwk",t.MXN="mxn",t.MXV="mxv",t.MYR="myr",t.MZN="mzn",t.NAD="nad",t.NGN="ngn",t.NIO="nio",t.NOK="nok",t.NPR="npr",t.NZD="nzd",t.OMR="omr",t.PAB="pab",t.PEN="pen",t.PGK="pgk",t.PHP="php",t.PKR="pkr",t.PLN="pln",t.PYG="pyg",t.QAR="qar",t.RON="ron",t.RSD="rsd",t.RUB="rub",t.RWF="rwf",t.SAR="sar",t.SBD="sbd",t.SCR="scr",t.SDG="sdg",t.SEK="sek",t.SGD="sgd",t.SHP="shp",t.SLL="sll",t.SOS="sos",t.SRD="srd",t.SSP="ssp",t.STD="std",t.SVC="svc",t.SYP="syp",t.SZL="szl",t.THB="thb",t.TJS="tjs",t.TMT="tmt",t.TND="tnd",t.TOP="top",t.TRY="try",t.TTD="ttd",t.TWD="twd",t.TZS="tzs",t.UAH="uah",t.UGX="ugx",t.USD="usd",t.USN="usn",t.USS="uss",t.UYI="uyi",t.UYU="uyu",t.UZS="uzs",t.VEF="vef",t.VND="vnd",t.VUV="vuv",t.WST="wst",t.XAF="xaf",t.XAG="xag",t.XAU="xau",t.XBA="xba",t.XBB="xbb",t.XBC="xbc",t.XBD="xbd",t.XCD="xcd",t.XDR="xdr",t.XFU="xfu",t.XOF="xof",t.XPD="xpd",t.XPF="xpf",t.XPT="xpt",t.XSU="xsu",t.XTS="xts",t.XUA="xua",t.YER="yer",t.ZAR="zar",t.ZMW="zmw",t.ZWL="zwl"}(m||(m={}));const f={[m.AED]:2,[m.AFN]:2,[m.ALL]:2,[m.AMD]:2,[m.ANG]:2,[m.AOA]:2,[m.ARS]:2,[m.AUD]:2,[m.AWG]:2,[m.AZN]:2,[m.BAM]:2,[m.BBD]:2,[m.BDT]:2,[m.BGN]:2,[m.BHD]:3,[m.BIF]:0,[m.BMD]:2,[m.BND]:2,[m.BOB]:2,[m.BOV]:2,[m.BRL]:2,[m.BSD]:2,[m.BTN]:2,[m.BWP]:2,[m.BYR]:0,[m.BYN]:2,[m.BZD]:2,[m.CAD]:2,[m.CDF]:2,[m.CHE]:2,[m.CHF]:2,[m.CHW]:2,[m.CLF]:0,[m.CLP]:0,[m.CNY]:2,[m.COP]:2,[m.COU]:2,[m.CRC]:2,[m.CUC]:2,[m.CUP]:2,[m.CVE]:2,[m.CZK]:2,[m.DJF]:0,[m.DKK]:2,[m.DOP]:2,[m.DZD]:2,[m.EGP]:2,[m.ERN]:2,[m.ETB]:2,[m.EUR]:2,[m.FJD]:2,[m.FKP]:2,[m.GBP]:2,[m.GEL]:2,[m.GHS]:2,[m.GIP]:2,[m.GMD]:2,[m.GNF]:0,[m.GTQ]:2,[m.GYD]:2,[m.HKD]:2,[m.HNL]:2,[m.HRK]:2,[m.HTG]:2,[m.HUF]:2,[m.IDR]:2,[m.ILS]:2,[m.INR]:2,[m.IQD]:3,[m.IRR]:2,[m.ISK]:0,[m.JMD]:2,[m.JOD]:3,[m.JPY]:0,[m.KES]:2,[m.KGS]:2,[m.KHR]:2,[m.KMF]:0,[m.KPW]:2,[m.KRW]:0,[m.KWD]:3,[m.KYD]:2,[m.KZT]:2,[m.LAK]:2,[m.LBP]:2,[m.LKR]:2,[m.LRD]:2,[m.LSL]:2,[m.LTL]:2,[m.LVL]:2,[m.LYD]:3,[m.MAD]:2,[m.MDL]:2,[m.MGA]:2,[m.MKD]:2,[m.MMK]:2,[m.MNT]:2,[m.MOP]:2,[m.MRO]:2,[m.MUR]:2,[m.MVR]:2,[m.MWK]:2,[m.MXN]:2,[m.MXV]:2,[m.MYR]:2,[m.MZN]:2,[m.NAD]:2,[m.NGN]:2,[m.NIO]:2,[m.NOK]:2,[m.NPR]:2,[m.NZD]:2,[m.OMR]:3,[m.PAB]:2,[m.PEN]:2,[m.PGK]:2,[m.PHP]:2,[m.PKR]:2,[m.PLN]:2,[m.PYG]:0,[m.QAR]:2,[m.RON]:2,[m.RSD]:2,[m.RUB]:2,[m.RWF]:0,[m.SAR]:2,[m.SBD]:2,[m.SCR]:2,[m.SDG]:2,[m.SEK]:2,[m.SGD]:2,[m.SHP]:2,[m.SLL]:2,[m.SOS]:2,[m.SRD]:2,[m.SSP]:2,[m.STD]:2,[m.SVC]:2,[m.SYP]:2,[m.SZL]:2,[m.THB]:2,[m.TJS]:2,[m.TMT]:2,[m.TND]:3,[m.TOP]:2,[m.TRY]:2,[m.TTD]:2,[m.TWD]:2,[m.TZS]:2,[m.UAH]:2,[m.UGX]:0,[m.USD]:2,[m.USN]:2,[m.USS]:2,[m.UYI]:0,[m.UYU]:2,[m.UZS]:2,[m.VEF]:2,[m.VND]:0,[m.VUV]:0,[m.WST]:2,[m.XAF]:0,[m.XAG]:0,[m.XAU]:0,[m.XBA]:0,[m.XBB]:0,[m.XBC]:0,[m.XBD]:0,[m.XCD]:2,[m.XDR]:0,[m.XFU]:0,[m.XOF]:0,[m.XPD]:0,[m.XPF]:0,[m.XPT]:0,[m.XSU]:0,[m.XTS]:0,[m.XUA]:0,[m.YER]:2,[m.ZAR]:2,[m.ZMW]:2,[m.ZWL]:2};const w=/\{([a-z]+)\}/g,S='/.proxy';function A(t,e){t.hasChildNodes()&&t.childNodes.forEach((t=>{D(t,e),A(t,e)}))}function D(t,e){if(t instanceof HTMLElement&&t.hasAttribute('src')){const s=t.getAttribute('src'),i=R(s??'');if(i.host===window.location.host)return;if('script'===t.tagName.toLowerCase())!function(t,{url:e,mappings:s}){const i=y({url:e,mappings:s});if(e.toString()!==i.toString()){const i=document.createElement(t.tagName);i.innerHTML=t.innerHTML;for(const e of t.attributes)i.setAttribute(e.name,e.value);i.setAttribute('src',y({url:e,mappings:s}).toString()),t.after(i),t.remove()}}(t,{url:i,mappings:e});else{const n=y({url:i,mappings:e}).toString();n!==s&&t.setAttribute('src',n)}}}function y({url:t,mappings:e}){const s=new URL(t.toString());!s.hostname.includes('discordsays.com')&&!s.hostname.includes('discordsez.com')||s.pathname.startsWith(S)||(s.pathname=S+s.pathname);for(const i of e){const e=b({originalURL:s,prefix:i.prefix,target:i.target,prefixHost:window.location.host});if(null!=e&&e?.toString()!==t.toString())return e}return s}function R(t,e=window.location.protocol,s=window.location.host){return new URL(t,`${e}//${s}`)}function b({originalURL:t,prefix:e,prefixHost:s,target:i}){const n=new URL(`https://${i}`),a=function(t){const e=t.replace(w,((t,e)=>`(?<${e}>[\\w-]+)`));return new RegExp(`${e}(/|$)`)}(n.host.replace(/%7B/g,'{').replace(/%7D/g,'}')),r=t.toString().match(a);if(null==r)return t;const o=new URL(t.toString());return o.host=s,o.pathname=e.replace(w,((t,e)=>{const s=r.groups?.[e];if(null==s)throw new Error('Misconfigured route.');return s})),o.pathname+='/'===o.pathname?t.pathname.slice(1):t.pathname,!o.hostname.includes('discordsays.com')&&!o.hostname.includes('discordsez.com')||o.pathname.startsWith(S)||(o.pathname=S+o.pathname),o.pathname=o.pathname.replace(n.pathname,''),t.pathname.endsWith('/')&&!o.pathname.endsWith('/')&&(o.pathname+='/'),o}class P{#t;#n;#a=new Set(["undefined"!=typeof window?window.location.origin:"","https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]);constructor(t,e){this.#t=t,this.#n=e,this.receive=this.receive.bind(this),this.authentication=this.authentication.bind(this)}parseMajorMobileVersion(t){if(t&&t.includes("."))try{return parseInt(t.split(".")[0])}catch{return-1}return-1}async receive(s){if(!this.#a.has(s.origin))return;const i=s.data,c=i?.[0];switch(c){case e.Handshake:case e.Hello:case e.Close:break;case e.Frame:{if(this.#t.stateCode==t.Stable){await this.#t.appSenderPromise;const t={hirpc_state:this.#t.stateCode,rpc_message:i};return void this.#t.appSender(this.serializePayload(t))}const e=window.dso_build_variables,s=i?.[1],c=s?.data,h=s?.evt,d=s?.cmd;if(d==r.DISPATCH&&h==o.READY){sessionStorage.setItem("dso_connected","true");const t=this.#t.getMultiEvent();t.ready=this.serializePayload(c),this.#t.getMultiEvent=()=>t,e.DISABLE_CONSOLE_LOG_OVERRIDE||this.#r();try{const t=e.MAPPINGS,s=e.PATCH_URL_MAPPINGS_CONFIG;t.length>0&&(e.DISABLE_INFO_LOGS||n(`Patching url mappings... (${t.length})`),this.#n.patchUrlMappings(t,s))}catch(t){a(`Something went wrong patching the URL mappings: ${t}`)}e.DISABLE_INFO_LOGS||n("Connected to RPC!"),this.#t.dispatchReady()}else if(d==r.AUTHORIZE&&h!=o.ERROR){const t=this.#t.getMultiEvent();t.authorize=this.serializePayload(c),this.#t.getMultiEvent=()=>t}else if(d==r.AUTHENTICATE){sessionStorage.setItem("dso_authenticated","true");const t=this.#t.getMultiEvent();t.authenticate=this.serializePayload(c),this.#t.getMultiEvent=()=>t,this.#t.dispatchAuth()}}}}async authentication(s){if(!this.#a.has(s.origin))return;const i=window.dso_build_variables,c=s.data,h=c?.[0],d=c?.[1],l=d?.data,p=d?.evt,u=d?.cmd;if(h==e.Frame)switch(u){case r.AUTHORIZE:{if(p==o.ERROR)return this.#t.stateCode=t.Errored,window.removeEventListener("message",this.receive),window.removeEventListener("message",this.authentication),void this.send(e.Close,{code:1e3,message:"User unauthorized scopes",nonce:this.getNonce()});i.DISABLE_INFO_LOGS||n("Authorized!");const s=i.TOKEN_REQUEST_PATH,c=i.SERVER_REQUEST;let h={code:l.code};if(""!=c){const t=JSON.parse(c);delete t.code,h={code:l.code,...t}}const d=await fetch(`/.proxy${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:this.serializePayload(h)}),u=await d.json();if(!u.token)return void a("The server JSON response didn't include a 'token' field");const g=this.#t.getMultiEvent();g.response=this.serializePayload(u),this.#t.getMultiEvent=()=>g,this.send(e.Frame,{cmd:r.AUTHENTICATE,nonce:this.getNonce(),args:{access_token:u.token}});break}case r.AUTHENTICATE:window.removeEventListener("message",this.authentication),i.DISABLE_INFO_LOGS||n("Authenticated!")}}send(t,e){let s,i;if(window.parent!=window.parent.parent){const t=window.parent.parent,e=window.parent;s=t.opener??t,i=e.document.referrer?e.document.referrer:"*"}else{const t=window.parent,e=window;s=t.opener??t,i=e.document.referrer?e.document.referrer:"*"}s.postMessage([t,e],i)}getNonce(){const t=new Array(36);for(let e=0;e<36;e++)t[e]=Math.floor(16*Math.random());return t[14]=4,t[19]=t[19]&=-5,t[19]=t[19]|=8,t[8]=t[13]=t[18]=t[23]="-",t.map((t=>t.toString(16))).join("")}serializePayload(t){return JSON.stringify(t,((t,e)=>"bigint"==typeof e?e.toString():e))}#r(){const t=(t,s)=>{this.send(e.Frame,{cmd:"CAPTURE_LOG",nonce:this.getNonce(),args:{level:t,message:s}})};["log","warn","debug","info","error"].forEach((e=>{const s=console[e],i=console;s&&(console[e]=function(){const n=[].slice.call(arguments),a=""+n.join(" ");t(e,a),s.apply(i,n)})}))}}class E{#t;#o;#n;#c;constructor(){if(this.#t=new u,this.#o=new p(this.#t),this.#n=new g,this.#c=new P(this.#t,this.#n),this.#t.readyPromise=new Promise((t=>{this.#t.dispatchReady=t})),this.#t.authPromise=new Promise((t=>{this.#t.dispatchAuth=t})),this.#t.appSenderPromise=new Promise((t=>{this.#t.dispatchAppSender=t})),"undefined"!=typeof window){this.getBuildVariables().DISABLE_INFO_LOGS||this.#h(),window.addEventListener("message",this.#c.receive)}}async load(e=1){if(this.#t.loaded)throw new Error("hiRPC Module already loaded");if("undefined"==typeof window)throw this.#t.stateCode=t.Unfunctional,new Error("Cannot load hiRPC Module outside of a web environment");this.#t.loaded=!0,this.#t.maxAccessCount=e;const s=this.getQueryObject(),i=sessionStorage.getItem("dso_instance_id");return s.instance_id!=i&&(sessionStorage.removeItem("dso_connected"),sessionStorage.removeItem("dso_authenticated"),sessionStorage.setItem("dso_instance_id",s.instance_id)),new Promise((async(e,s)=>{if("true"==sessionStorage.getItem("dso_outside_discord"))return this.#t.stateCode=t.OutsideDiscord,void e();const i=this.getQueryObject();if(!i.frame_id||!i.instance_id||!i.platform)return this.#t.stateCode=t.OutsideDiscord,void e();const n=sessionStorage.getItem("dso_connected");if("false"==n||null==n)await this.#d();else{if("true"!=n)return void s(new Error(`Invalid session storage item: { dso_connected: ${n} }`));this.#t.dispatchReady()}const a=sessionStorage.getItem("dso_authenticated");if("false"==a||null==a)await this.#l();else{if("true"!=a)return void s(new Error(`Invalid session storage item: { dso_authenticated: ${a} }`));this.#t.dispatchAuth()}this.#t.stateCode=t.Stable,e()}))}async#d(){const t=this.getQueryObject(),s=this.getBuildVariables(),i=s.CLIENT_ID,a=s.DISABLE_INFO_LOGS,r=this.#c.parseMajorMobileVersion(t.mobile_app_version),o={v:1,encoding:"json",client_id:i,frame_id:t.frame_id};(t.platform===c.DESKTOP||r>=250)&&(o.sdk_version=l),a||n("Connecting..."),this.#c.send(e.Handshake,o),await this.#t.readyPromise}async#l(){window.addEventListener("message",this.#c.authentication);const t=this.getBuildVariables();this.#c.send(e.Frame,{cmd:r.AUTHORIZE,nonce:this.getNonce(),args:{client_id:t.CLIENT_ID,scope:t.OAUTH_SCOPES,response_type:"code",prompt:"none",state:""}}),await this.#t.authPromise}#h(){n(`hiRPC! version ${h}`)}getBuildVariables(){if("object"==typeof window.dso_build_variables)return window.dso_build_variables;if("object"==typeof window.Dissonity.BuildVariables)return window.dso_build_variables=new window.Dissonity.BuildVariables.default,window.dso_build_variables;throw a("Unable to access build variables. Import them through <import map>/dissonity_build_variables.js"),this.#t.stateCode=t.Errored,new Error("Unable to access build variables. Import them through <import map>/dissonity_build_variables.js")}patchUrlMappings(t,e,s){this.#o.verifyHash(t)&&this.#n.patchUrlMappings(e,s)}formatPrice(t,e,s){if(this.#o.verifyHash(t))return this.#n.formatPrice(e,s)}getQueryObject(){const t=window.location.search.includes("?")?window.location.search.replace("?","").split("&"):window.parent.location.search.replace("?","").split("&"),e={};if(0!=t.length)for(let s=0;s<t.length;s++)e[t[s].split("=")[0]]=t[s].split("=")[1];return e}getNonce(){return this.#c.getNonce()}getVersions(){return{embedded_app_sdk:l,hirpc:h}}async requestHash(){return this.#t.loaded?this.#o.requestHash():null}async sendToRpc(t,s=e.Frame,i){this.#o.verifyHash(t)&&(await this.#t.readyPromise,this.#c.send(s,i))}sendToJs(t,e,s){if(!this.#o.verifyAppHash(t))return;if(e==d)throw new Error(`Cannot send message through the "${d}" channel`);const i=this.#t.appListeners.get(e);if(i)for(const t of i)t(s)}async sendToApp(t,e,s){if(this.#o.verifyAccessHash(t)){if(e==d)throw new Error(`Cannot send message through the "${d}" channel`)}else if(!this.#o.verifyAppHash(t))return;await this.#t.appSenderPromise;const i={hirpc_state:this.#t.stateCode,hirpc_message:{channel:e,data:s}};this.#t.appSender(this.#c.serializePayload(i))}addAppListener(t,e,s){if(!this.#o.verifyHash(t))return;this.#t.appListeners.has(e)||this.#t.appListeners.set(e,[]);this.#t.appListeners.get(e).push(s)}removeAppListener(t,e,s){if(!this.#o.verifyHash(t))return;if(!this.#t.appListeners.has(e))return;const i=this.#t.appListeners.get(e),n=i.indexOf(s);-1!=n&&(i.splice(n,1),0==i.length&&this.#t.appListeners.delete(e))}lockHashAccess(){this.#o.lock()}async openDownwardFlow(t){if(null!=this.#t.appSender)throw new Error("An app sender has already been defined");this.#o.lock(),this.#t.appSender=t;const e=sessionStorage.getItem("dso_outside_discord");"true"!=e&&await this.#t.authPromise;const s={raw_multi_event:"true"!=e?this.#t.getMultiEvent():null,hash:await this.#o.generateHash(!0)},i={hirpc_state:this.#t.stateCode,hirpc_message:{channel:d,data:s,opening:!0}};this.#t.appSender(this.#c.serializePayload(i)),this.#t.dispatchAppSender()}closeDownwardFlow(t){this.#o.verifyHash(t)&&null!=this.#t.appSender&&(this.#t.appSenderPromise=new Promise((t=>{this.#t.dispatchAppSender=t})),this.#t.appSender=null)}}(self.Dissonity=self.Dissonity||{}).HiRpc=i})();