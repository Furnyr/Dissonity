(()=>{"use strict";var e,t,s={d:(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})}},i={};function n(e){console.log(`%c[DissonityHiRpc]%c ${e}`,"color:#8177f6;font-weight: bold;","color:initial;")}function a(e){console.error(`%c[DissonityHiRpc]%c ${e}`,"color:#8177f6;font-weight: bold;","color:initial;")}s.r(i),s.d(i,{default:()=>P}),function(e){e[e.Unfunctional=0]="Unfunctional",e[e.OutsideDiscord=1]="OutsideDiscord",e[e.Errored=2]="Errored",e[e.Loading=3]="Loading",e[e.Stable=4]="Stable"}(e||(e={})),function(e){e[e.Handshake=0]="Handshake",e[e.Frame=1]="Frame",e[e.Close=2]="Close",e[e.Hello=3]="Hello"}(t||(t={}));const r=Object.freeze({DISPATCH:"DISPATCH",AUTHORIZE:"AUTHORIZE",AUTHENTICATE:"AUTHENTICATE"}),o=Object.freeze({READY:"READY",ERROR:"ERROR"}),c=Object.freeze({MOBILE:"mobile",DESKTOP:"desktop"}),h="0.5.2",d="dissonity",l="2.0.0";class p{#e;#t=!1;#s=null;#i=()=>null;#n=()=>null;constructor(e){this.#e=e}async generateHash(e=!1){if(e){if(null!=this.#n(null))throw new Error("App hash is locked")}else{if(null!=this.#s)return this.#s;if(null!=this.#i(null))throw new Error("Access hash is locked")}const t=window.crypto.getRandomValues(new Uint8Array(16)),s=(new TextEncoder).encode(Date.now().toString()),i=new Uint8Array(t.length+s.length);i.set(s),i.set(t,s.length);const n=await window.crypto.subtle.digest("SHA-256",i),a=Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("");return e?this.#n=e=>null!=e&&this.compareHashes(e,a):(this.#s=a,this.#i=e=>null!=e&&this.compareHashes(e,a)),a}async requestHash(){return this.#t||this.#e.accessCount>=this.#e.maxAccessCount?null:(this.#e.accessCount++,await this.generateHash())}compareHashes(e,t){if(e.length!=t.length)return!1;let s=0;for(let i=0;i<e.length;i++)s|=e.charCodeAt(i)^t.charCodeAt(i);return 0==s}verifyHash(e){return!!this.#i(e)||!!this.#n(e)}verifyAccessHash(e){return!!this.#i(e)}verifyAppHash(e){return!!this.#n(e)}lock(){this.#s=null,this.#t=!0}}class u{constructor(){this.maxAccessCount=1,this.accessCount=0,this.appSender=null,this.appSenderPromise=null,this.dispatchAppSender=null,this.appListeners=new Map,this.loaded=!1,this.stateCode=e.Loading,this.errorMessage=null,this.readyPromise=null,this.dispatchReady=null,this.authPromise=null,this.dispatchAuth=null,this.getMultiEvent=()=>({ready:"",authorize:"",authenticate:"",response:""})}}class f{formatPrice(e,t="en-US"){const{amount:s,currency:i}=e;return Intl.NumberFormat(t,{style:'currency',currency:i}).format(function(e,t){const s=m[t];if(null==s)return console.warn(`Unexpected currency ${t}`),e;return e/10**s}(s,i))}patchUrlMappings(e,{patchFetch:t=!0,patchWebSocket:s=!0,patchXhr:i=!0,patchSrcAttributes:n=!1}={}){if('undefined'!=typeof window){if(t){const t=window.fetch;window.fetch=function(s,i){if(s instanceof Request){const n=D({url:b(s.url),mappings:e}),{url:a,...r}=i??{};return Object.keys(Request.prototype).forEach((e=>{if('url'!==e)try{r[e]=s[e]}catch(t){console.warn(`Remapping fetch request key "${e}" failed`,t)}})),new Promise(((e,i)=>{try{s.blob().then((i=>{'HEAD'!==s.method.toUpperCase()&&'GET'!==s.method.toUpperCase()&&i.size>0&&(r.body=i),e(t(new Request(n,r)))}))}catch(e){i(e)}}))}const n=D({url:s instanceof URL?s:b(s),mappings:e});return t(n,i)}}if(s){class t extends WebSocket{constructor(t,s){super(D({url:t instanceof URL?t:b(t),mappings:e}),s)}}window.WebSocket=t}if(i){const t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(s,i,n,a,r){const o=D({url:b(i),mappings:e});t.apply(this,[s,o,n,a,r])}}if(n){const t={attributeFilter:['src'],childList:!0,subtree:!0};new MutationObserver((function(t){for(const s of t)'attributes'===s.type&&'src'===s.attributeName?A(s.target,e):'childList'===s.type&&s.addedNodes.forEach((t=>{A(t,e),y(t,e)}))})).observe(window.document,t),window.document.querySelectorAll('[src]').forEach((t=>{A(t,e)}))}}}}var g;!function(e){e.AED="aed",e.AFN="afn",e.ALL="all",e.AMD="amd",e.ANG="ang",e.AOA="aoa",e.ARS="ars",e.AUD="aud",e.AWG="awg",e.AZN="azn",e.BAM="bam",e.BBD="bbd",e.BDT="bdt",e.BGN="bgn",e.BHD="bhd",e.BIF="bif",e.BMD="bmd",e.BND="bnd",e.BOB="bob",e.BOV="bov",e.BRL="brl",e.BSD="bsd",e.BTN="btn",e.BWP="bwp",e.BYN="byn",e.BYR="byr",e.BZD="bzd",e.CAD="cad",e.CDF="cdf",e.CHE="che",e.CHF="chf",e.CHW="chw",e.CLF="clf",e.CLP="clp",e.CNY="cny",e.COP="cop",e.COU="cou",e.CRC="crc",e.CUC="cuc",e.CUP="cup",e.CVE="cve",e.CZK="czk",e.DJF="djf",e.DKK="dkk",e.DOP="dop",e.DZD="dzd",e.EGP="egp",e.ERN="ern",e.ETB="etb",e.EUR="eur",e.FJD="fjd",e.FKP="fkp",e.GBP="gbp",e.GEL="gel",e.GHS="ghs",e.GIP="gip",e.GMD="gmd",e.GNF="gnf",e.GTQ="gtq",e.GYD="gyd",e.HKD="hkd",e.HNL="hnl",e.HRK="hrk",e.HTG="htg",e.HUF="huf",e.IDR="idr",e.ILS="ils",e.INR="inr",e.IQD="iqd",e.IRR="irr",e.ISK="isk",e.JMD="jmd",e.JOD="jod",e.JPY="jpy",e.KES="kes",e.KGS="kgs",e.KHR="khr",e.KMF="kmf",e.KPW="kpw",e.KRW="krw",e.KWD="kwd",e.KYD="kyd",e.KZT="kzt",e.LAK="lak",e.LBP="lbp",e.LKR="lkr",e.LRD="lrd",e.LSL="lsl",e.LTL="ltl",e.LVL="lvl",e.LYD="lyd",e.MAD="mad",e.MDL="mdl",e.MGA="mga",e.MKD="mkd",e.MMK="mmk",e.MNT="mnt",e.MOP="mop",e.MRO="mro",e.MUR="mur",e.MVR="mvr",e.MWK="mwk",e.MXN="mxn",e.MXV="mxv",e.MYR="myr",e.MZN="mzn",e.NAD="nad",e.NGN="ngn",e.NIO="nio",e.NOK="nok",e.NPR="npr",e.NZD="nzd",e.OMR="omr",e.PAB="pab",e.PEN="pen",e.PGK="pgk",e.PHP="php",e.PKR="pkr",e.PLN="pln",e.PYG="pyg",e.QAR="qar",e.RON="ron",e.RSD="rsd",e.RUB="rub",e.RWF="rwf",e.SAR="sar",e.SBD="sbd",e.SCR="scr",e.SDG="sdg",e.SEK="sek",e.SGD="sgd",e.SHP="shp",e.SLL="sll",e.SOS="sos",e.SRD="srd",e.SSP="ssp",e.STD="std",e.SVC="svc",e.SYP="syp",e.SZL="szl",e.THB="thb",e.TJS="tjs",e.TMT="tmt",e.TND="tnd",e.TOP="top",e.TRY="try",e.TTD="ttd",e.TWD="twd",e.TZS="tzs",e.UAH="uah",e.UGX="ugx",e.USD="usd",e.USN="usn",e.USS="uss",e.UYI="uyi",e.UYU="uyu",e.UZS="uzs",e.VEF="vef",e.VND="vnd",e.VUV="vuv",e.WST="wst",e.XAF="xaf",e.XAG="xag",e.XAU="xau",e.XBA="xba",e.XBB="xbb",e.XBC="xbc",e.XBD="xbd",e.XCD="xcd",e.XDR="xdr",e.XFU="xfu",e.XOF="xof",e.XPD="xpd",e.XPF="xpf",e.XPT="xpt",e.XSU="xsu",e.XTS="xts",e.XUA="xua",e.YER="yer",e.ZAR="zar",e.ZMW="zmw",e.ZWL="zwl"}(g||(g={}));const m={[g.AED]:2,[g.AFN]:2,[g.ALL]:2,[g.AMD]:2,[g.ANG]:2,[g.AOA]:2,[g.ARS]:2,[g.AUD]:2,[g.AWG]:2,[g.AZN]:2,[g.BAM]:2,[g.BBD]:2,[g.BDT]:2,[g.BGN]:2,[g.BHD]:3,[g.BIF]:0,[g.BMD]:2,[g.BND]:2,[g.BOB]:2,[g.BOV]:2,[g.BRL]:2,[g.BSD]:2,[g.BTN]:2,[g.BWP]:2,[g.BYR]:0,[g.BYN]:2,[g.BZD]:2,[g.CAD]:2,[g.CDF]:2,[g.CHE]:2,[g.CHF]:2,[g.CHW]:2,[g.CLF]:0,[g.CLP]:0,[g.CNY]:2,[g.COP]:2,[g.COU]:2,[g.CRC]:2,[g.CUC]:2,[g.CUP]:2,[g.CVE]:2,[g.CZK]:2,[g.DJF]:0,[g.DKK]:2,[g.DOP]:2,[g.DZD]:2,[g.EGP]:2,[g.ERN]:2,[g.ETB]:2,[g.EUR]:2,[g.FJD]:2,[g.FKP]:2,[g.GBP]:2,[g.GEL]:2,[g.GHS]:2,[g.GIP]:2,[g.GMD]:2,[g.GNF]:0,[g.GTQ]:2,[g.GYD]:2,[g.HKD]:2,[g.HNL]:2,[g.HRK]:2,[g.HTG]:2,[g.HUF]:2,[g.IDR]:2,[g.ILS]:2,[g.INR]:2,[g.IQD]:3,[g.IRR]:2,[g.ISK]:0,[g.JMD]:2,[g.JOD]:3,[g.JPY]:0,[g.KES]:2,[g.KGS]:2,[g.KHR]:2,[g.KMF]:0,[g.KPW]:2,[g.KRW]:0,[g.KWD]:3,[g.KYD]:2,[g.KZT]:2,[g.LAK]:2,[g.LBP]:2,[g.LKR]:2,[g.LRD]:2,[g.LSL]:2,[g.LTL]:2,[g.LVL]:2,[g.LYD]:3,[g.MAD]:2,[g.MDL]:2,[g.MGA]:2,[g.MKD]:2,[g.MMK]:2,[g.MNT]:2,[g.MOP]:2,[g.MRO]:2,[g.MUR]:2,[g.MVR]:2,[g.MWK]:2,[g.MXN]:2,[g.MXV]:2,[g.MYR]:2,[g.MZN]:2,[g.NAD]:2,[g.NGN]:2,[g.NIO]:2,[g.NOK]:2,[g.NPR]:2,[g.NZD]:2,[g.OMR]:3,[g.PAB]:2,[g.PEN]:2,[g.PGK]:2,[g.PHP]:2,[g.PKR]:2,[g.PLN]:2,[g.PYG]:0,[g.QAR]:2,[g.RON]:2,[g.RSD]:2,[g.RUB]:2,[g.RWF]:0,[g.SAR]:2,[g.SBD]:2,[g.SCR]:2,[g.SDG]:2,[g.SEK]:2,[g.SGD]:2,[g.SHP]:2,[g.SLL]:2,[g.SOS]:2,[g.SRD]:2,[g.SSP]:2,[g.STD]:2,[g.SVC]:2,[g.SYP]:2,[g.SZL]:2,[g.THB]:2,[g.TJS]:2,[g.TMT]:2,[g.TND]:3,[g.TOP]:2,[g.TRY]:2,[g.TTD]:2,[g.TWD]:2,[g.TZS]:2,[g.UAH]:2,[g.UGX]:0,[g.USD]:2,[g.USN]:2,[g.USS]:2,[g.UYI]:0,[g.UYU]:2,[g.UZS]:2,[g.VEF]:2,[g.VND]:0,[g.VUV]:0,[g.WST]:2,[g.XAF]:0,[g.XAG]:0,[g.XAU]:0,[g.XBA]:0,[g.XBB]:0,[g.XBC]:0,[g.XBD]:0,[g.XCD]:2,[g.XDR]:0,[g.XFU]:0,[g.XOF]:0,[g.XPD]:0,[g.XPF]:0,[g.XPT]:0,[g.XSU]:0,[g.XTS]:0,[g.XUA]:0,[g.YER]:2,[g.ZAR]:2,[g.ZMW]:2,[g.ZWL]:2};const w=/\{([a-z]+)\}/g,S='/.proxy';function y(e,t){e.hasChildNodes()&&e.childNodes.forEach((e=>{A(e,t),y(e,t)}))}function A(e,t){if(e instanceof HTMLElement&&e.hasAttribute('src')){const s=e.getAttribute('src'),i=b(s??'');if(i.host===window.location.host)return;if('script'===e.tagName.toLowerCase())!function(e,{url:t,mappings:s}){const i=D({url:t,mappings:s});if(t.toString()!==i.toString()){const i=document.createElement(e.tagName);i.innerHTML=e.innerHTML;for(const t of e.attributes)i.setAttribute(t.name,t.value);i.setAttribute('src',D({url:t,mappings:s}).toString()),e.after(i),e.remove()}}(e,{url:i,mappings:t});else{const n=D({url:i,mappings:t}).toString();n!==s&&e.setAttribute('src',n)}}}function D({url:e,mappings:t}){const s=new URL(e.toString());!s.hostname.includes('discordsays.com')&&!s.hostname.includes('discordsez.com')||s.pathname.startsWith(S)||(s.pathname=S+s.pathname);for(const i of t){const t=R({originalURL:s,prefix:i.prefix,target:i.target,prefixHost:window.location.host});if(null!=t&&t?.toString()!==e.toString())return t}return s}function b(e,t=window.location.protocol,s=window.location.host){return new URL(e,`${t}//${s}`)}function R({originalURL:e,prefix:t,prefixHost:s,target:i}){const n=new URL(`https://${i}`),a=function(e){const t=e.replace(w,((e,t)=>`(?<${t}>[\\w-]+)`));return new RegExp(`${t}(/|$)`)}(n.host.replace(/%7B/g,'{').replace(/%7D/g,'}')),r=e.toString().match(a);if(null==r)return e;const o=new URL(e.toString());return o.host=s,o.pathname=t.replace(w,((e,t)=>{const s=r.groups?.[t];if(null==s)throw new Error('Misconfigured route.');return s})),o.pathname+='/'===o.pathname?e.pathname.slice(1):e.pathname,!o.hostname.includes('discordsays.com')&&!o.hostname.includes('discordsez.com')||o.pathname.startsWith(S)||(o.pathname=S+o.pathname),o.pathname=o.pathname.replace(n.pathname,''),e.pathname.endsWith('/')&&!o.pathname.endsWith('/')&&(o.pathname+='/'),o}class E{#e;#a;#r=new Set(["undefined"!=typeof window?window.location.origin:"","https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]);constructor(e,t){this.#e=e,this.#a=t,this.receive=this.receive.bind(this),this.authentication=this.authentication.bind(this)}parseMajorMobileVersion(e){if(e&&e.includes("."))try{return parseInt(e.split(".")[0])}catch{return-1}return-1}async receive(s){if(!this.#r.has(s.origin))return;const i=s.data,c=i?.[0];switch(c){case t.Handshake:case t.Hello:case t.Close:break;case t.Frame:{if(this.#e.stateCode==e.Stable){await this.#e.appSenderPromise;const e={hirpc_state:this.#e.stateCode,rpc_message:i};return void this.#e.appSender(this.serializePayload(e))}const t=window.dso_build_variables,s=i?.[1],c=s?.data,h=s?.evt,d=s?.cmd;if(d==r.DISPATCH&&h==o.READY){sessionStorage.setItem("dso_connected","true");const e=this.#e.getMultiEvent();e.ready=this.serializePayload(c),this.#e.getMultiEvent=()=>e,t.DISABLE_CONSOLE_LOG_OVERRIDE||this.#o();try{const e=t.MAPPINGS,s=t.PATCH_URL_MAPPINGS_CONFIG;e.length>0&&(t.DISABLE_INFO_LOGS||n(`Patching url mappings... (${e.length})`),this.#a.patchUrlMappings(e,s))}catch(e){a(`Something went wrong patching the URL mappings: ${e}`)}t.DISABLE_INFO_LOGS||n("Connected to RPC!"),this.#e.dispatchReady()}else if(d==r.AUTHORIZE&&h!=o.ERROR){const e=this.#e.getMultiEvent();e.authorize=this.serializePayload(c),this.#e.getMultiEvent=()=>e}else if(d==r.AUTHENTICATE){sessionStorage.setItem("dso_authenticated","true");const e=this.#e.getMultiEvent();e.authenticate=this.serializePayload(c),this.#e.getMultiEvent=()=>e,this.#e.dispatchAuth()}}}}async authentication(s){if(!this.#r.has(s.origin))return;const i=window.dso_build_variables,c=s.data,h=c?.[0],d=c?.[1],l=d?.data,p=d?.evt,u=d?.cmd;if(h==t.Frame)switch(u){case r.AUTHORIZE:{if(p==o.ERROR)return this.#e.stateCode=e.Errored,this.#e.errorMessage="User unauthorized scopes",window.removeEventListener("message",this.receive),window.removeEventListener("message",this.authentication),void this.send(t.Close,{code:1e3,message:"User unauthorized scopes",nonce:this.getNonce()});i.DISABLE_INFO_LOGS||n("Authorized!");const s=i.TOKEN_REQUEST_PATH,c=i.SERVER_REQUEST;let h={code:l.code};if(""!=c){const e=JSON.parse(c);delete e.code,h={code:l.code,...e}}const d=await fetch(`/.proxy${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:this.serializePayload(h)}),u=await d.json();if(!u.token){const t="The server JSON response didn't include a 'token' field";return a(t),this.#e.stateCode=e.Errored,void(this.#e.errorMessage=t)}const f=this.#e.getMultiEvent();f.response=this.serializePayload(u),this.#e.getMultiEvent=()=>f,this.send(t.Frame,{cmd:r.AUTHENTICATE,nonce:this.getNonce(),args:{access_token:u.token}});break}case r.AUTHENTICATE:window.removeEventListener("message",this.authentication),i.DISABLE_INFO_LOGS||n("Authenticated!")}}send(e,t){let s,i;if(window.parent!=window.parent.parent){const e=window.parent.parent,t=window.parent;s=e.opener??e,i=t.document.referrer?t.document.referrer:"*"}else{const e=window.parent,t=window;s=e.opener??e,i=t.document.referrer?t.document.referrer:"*"}s.postMessage([e,t],i)}getNonce(){const e=new Array(36);for(let t=0;t<36;t++)e[t]=Math.floor(16*Math.random());return e[14]=4,e[19]=e[19]&=-5,e[19]=e[19]|=8,e[8]=e[13]=e[18]=e[23]="-",e.map((e=>e.toString(16))).join("")}serializePayload(e){return JSON.stringify(e,((e,t)=>"bigint"==typeof t?t.toString():t))}#o(){const e=(e,s)=>{this.send(t.Frame,{cmd:"CAPTURE_LOG",nonce:this.getNonce(),args:{level:e,message:s}})};["log","warn","debug","info","error"].forEach((t=>{const s=console[t],i=console;s&&(console[t]=function(){const n=[].slice.call(arguments),a=""+n.join(" ");e(t,a),s.apply(i,n)})}))}}class P{#e;#c;#a;#h;constructor(){if(this.#e=new u,this.#c=new p(this.#e),this.#a=new f,this.#h=new E(this.#e,this.#a),this.#e.readyPromise=new Promise((e=>{this.#e.dispatchReady=e})),this.#e.authPromise=new Promise((e=>{this.#e.dispatchAuth=e})),this.#e.appSenderPromise=new Promise((e=>{this.#e.dispatchAppSender=e})),"undefined"!=typeof window){if(window.dso_hirpc instanceof P)return window.dso_hirpc;Object.defineProperty(window,"dso_hirpc",{value:this,writable:!1,configurable:!1}),Object.freeze(window.dso_hirpc);this.getBuildVariables().DISABLE_INFO_LOGS||this.#d(),window.addEventListener("message",this.#h.receive)}}async load(t=1){if(this.#e.loaded)throw new Error("hiRPC Module already loaded");if("undefined"==typeof window)throw this.#e.stateCode=e.Unfunctional,new Error("Cannot load hiRPC Module outside of a web environment");this.#e.loaded=!0,this.#e.maxAccessCount=t;const s=this.getQueryObject(),i=sessionStorage.getItem("dso_instance_id");return s.instance_id!=i&&(sessionStorage.removeItem("dso_connected"),sessionStorage.removeItem("dso_authenticated"),sessionStorage.setItem("dso_instance_id",s.instance_id)),new Promise((async(t,s)=>{if("true"==sessionStorage.getItem("dso_outside_discord"))return this.#e.stateCode=e.OutsideDiscord,void t();const i=this.getQueryObject();if(!i.frame_id||!i.instance_id||!i.platform)return this.#e.stateCode=e.OutsideDiscord,void t();const n=sessionStorage.getItem("dso_connected");if("false"==n||null==n)await this.#l();else{if("true"!=n)return void s(new Error(`Invalid session storage item: { dso_connected: ${n} }`));this.#e.dispatchReady()}const a=sessionStorage.getItem("dso_authenticated");if("false"==a||null==a)await this.#p();else{if("true"!=a)return void s(new Error(`Invalid session storage item: { dso_authenticated: ${a} }`));this.#e.dispatchAuth()}this.#e.stateCode=e.Stable,t()}))}async#l(){const e=this.getQueryObject(),s=this.getBuildVariables(),i=s.CLIENT_ID,a=s.DISABLE_INFO_LOGS,r=this.#h.parseMajorMobileVersion(e.mobile_app_version),o={v:1,encoding:"json",client_id:i,frame_id:e.frame_id};(e.platform===c.DESKTOP||r>=250)&&(o.sdk_version=l),a||n("Connecting..."),this.#h.send(t.Handshake,o),await this.#e.readyPromise}async#p(){window.addEventListener("message",this.#h.authentication);const e=this.getBuildVariables();this.#h.send(t.Frame,{cmd:r.AUTHORIZE,nonce:this.getNonce(),args:{client_id:e.CLIENT_ID,scope:e.OAUTH_SCOPES,response_type:"code",prompt:"none",state:""}}),await this.#e.authPromise}#d(){n(`hiRPC! version ${h}`)}getBuildVariables(){if("object"==typeof window.dso_build_variables)return window.dso_build_variables;if("object"==typeof window.Dissonity.BuildVariables)return Object.defineProperty(window,"dso_build_variables",{value:new window.Dissonity.BuildVariables.default,writable:!1,configurable:!1}),Object.freeze(window.dso_build_variables),window.dso_build_variables;{const t="Unable to access build variables. Import them through <import map>/dissonity_build_variables.js";throw a(t),this.#e.stateCode=e.Errored,this.#e.errorMessage=t,new Error(t)}}patchUrlMappings(e,t,s){this.#c.verifyHash(e)&&this.#a.patchUrlMappings(t,s)}formatPrice(e,t,s){if(this.#c.verifyHash(e))return this.#a.formatPrice(t,s)}getQueryObject(){const e=window.location.search.includes("?")?window.location.search.replace("?","").split("&"):window.parent.location.search.replace("?","").split("&"),t={};if(0!=e.length)for(let s=0;s<e.length;s++)t[e[s].split("=")[0]]=e[s].split("=")[1];return t}getNonce(){return this.#h.getNonce()}getVersions(){return{embedded_app_sdk:l,hirpc:h}}async requestHash(){return this.#e.loaded?this.#c.requestHash():null}async sendToRpc(e,s=t.Frame,i){this.#c.verifyHash(e)&&(await this.#e.readyPromise,this.#h.send(s,i))}sendToJs(e,t,s){if(!this.#c.verifyAppHash(e))return;if(t==d)throw new Error(`Cannot send message through the "${d}" channel`);const i=this.#e.appListeners.get(t);if(i)for(const e of i)e(s)}async sendToApp(e,t,s){if(this.#c.verifyAccessHash(e)){if(t==d)throw new Error(`Cannot send message through the "${d}" channel`)}else if(!this.#c.verifyAppHash(e))return;await this.#e.appSenderPromise;const i={hirpc_state:this.#e.stateCode,hirpc_message:{channel:t,data:s}};this.#e.appSender(this.#h.serializePayload(i))}addAppListener(e,t,s){if(!this.#c.verifyHash(e))return;this.#e.appListeners.has(t)||this.#e.appListeners.set(t,[]);this.#e.appListeners.get(t).push(s)}removeAppListener(e,t,s){if(!this.#c.verifyHash(e))return;if(!this.#e.appListeners.has(t))return;const i=this.#e.appListeners.get(t),n=i.indexOf(s);-1!=n&&(i.splice(n,1),0==i.length&&this.#e.appListeners.delete(t))}lockHashAccess(){this.#c.lock()}async openDownwardFlow(t){if(null!=this.#e.appSender)throw new Error("An app sender has already been defined");if(this.#c.lock(),this.#e.appSender=t,this.#e.stateCode==e.Errored){const e={message:this.#e.errorMessage??"Unknown error"},t={hirpc_state:this.#e.stateCode,hirpc_message:{channel:d,data:e,error:!0}};return void this.#e.appSender(this.#h.serializePayload(t))}const s=sessionStorage.getItem("dso_outside_discord");"true"!=s&&await this.#e.authPromise;const i={raw_multi_event:"true"!=s?this.#e.getMultiEvent():null,hash:await this.#c.generateHash(!0)},n={hirpc_state:this.#e.stateCode,hirpc_message:{channel:d,data:i,opening:!0}};this.#e.appSender(this.#h.serializePayload(n)),this.#e.dispatchAppSender()}closeDownwardFlow(e){this.#c.verifyHash(e)&&null!=this.#e.appSender&&(this.#e.appSenderPromise=new Promise((e=>{this.#e.dispatchAppSender=e})),this.#e.appSender=null)}}(self.Dissonity=self.Dissonity||{}).HiRpc=i})();