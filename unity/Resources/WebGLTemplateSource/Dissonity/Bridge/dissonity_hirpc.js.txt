(()=>{"use strict";var t,e,s={d:(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(t,'__esModule',{value:!0})}},i={};function n(t){console.log(`%c[DissonityHiRpc]%c ${t}`,"color:#8177f6;font-weight: bold;","color:initial;")}function a(t){console.error(`%c[DissonityHiRpc]%c ${t}`,"color:#8177f6;font-weight: bold;","color:initial;")}s.r(i),s.d(i,{default:()=>P}),function(t){t[t.Unfunctional=0]="Unfunctional",t[t.OutsideDiscord=1]="OutsideDiscord",t[t.Errored=2]="Errored",t[t.Loading=3]="Loading",t[t.Stable=4]="Stable"}(t||(t={})),function(t){t[t.Handshake=0]="Handshake",t[t.Frame=1]="Frame",t[t.Close=2]="Close",t[t.Hello=3]="Hello"}(e||(e={}));const r=Object.freeze({DISPATCH:"DISPATCH",AUTHORIZE:"AUTHORIZE",AUTHENTICATE:"AUTHENTICATE"}),o=Object.freeze({READY:"READY",ERROR:"ERROR"}),c=Object.freeze({MOBILE:"mobile",DESKTOP:"desktop"}),h="0.4.1",d="dissonity",l="1.9.0";class p{#t;#e=!1;#s=()=>null;#i=()=>null;constructor(t){this.#t=t}async generateHash(t=!1){if(t&&null!=this.#i())return this.#i();if(null!=this.#s())return this.#s();const e=window.crypto.getRandomValues(new Uint8Array(16)),s=(new TextEncoder).encode(Date.now().toString()),i=new Uint8Array(e.length+s.length);i.set(s),i.set(e,s.length);const n=await window.crypto.subtle.digest("SHA-256",i),a=Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("");return t?this.#i=()=>a:this.#s=()=>a,a}async requestHash(){return this.#e||this.#t.accessCount>=this.#t.maxAccessCount?null:(this.#t.accessCount++,await this.generateHash())}compareHashes(t,e){if(t.length!=e.length)return!1;let s=0;for(let i=0;i<t.length;i++)s|=t.charCodeAt(i)^e.charCodeAt(i);return 0==s}verifyHash(t){return this.verifyAccessHash(t)||this.verifyAppHash(t)}verifyAccessHash(t){return null!=this.#s()&&this.compareHashes(t,this.#s())}verifyAppHash(t){return null!=this.#i()&&this.compareHashes(t,this.#i())}lock(){this.#e=!0}}class u{constructor(){this.maxAccessCount=1,this.accessCount=0,this.appSender=null,this.appSenderPromise=null,this.dispatchAppSender=null,this.appListeners=[],this.loaded=!1,this.stateCode=t.Loading,this.readyPromise=null,this.dispatchReady=null,this.authPromise=null,this.dispatchAuth=null,this.multiEvent={ready:"",authorize:"",authenticate:"",response:""}}}class m{formatPrice(t,e="en-US"){const{amount:s,currency:i}=t;return Intl.NumberFormat(e,{style:'currency',currency:i}).format(function(t,e){const s=g[e];if(null==s)return console.warn(`Unexpected currency ${e}`),t;return t/10**s}(s,i))}patchUrlMappings(t,{patchFetch:e=!0,patchWebSocket:s=!0,patchXhr:i=!0,patchSrcAttributes:n=!1}={}){if('undefined'!=typeof window){if(e){const e=window.fetch;window.fetch=function(s,i){if(s instanceof Request){const n=y({url:R(s.url),mappings:t}),{url:a,...r}=i??{};return Object.keys(Request.prototype).forEach((t=>{if('url'!==t)try{r[t]=s[t]}catch(e){console.warn(`Remapping fetch request key "${t}" failed`,e)}})),new Promise(((t,i)=>{try{s.blob().then((i=>{'HEAD'!==s.method.toUpperCase()&&'GET'!==s.method.toUpperCase()&&i.size>0&&(r.body=i),t(e(new Request(n,r)))}))}catch(t){i(t)}}))}const n=y({url:s instanceof URL?s:R(s),mappings:t});return e(n,i)}}if(s){class e extends WebSocket{constructor(e,s){super(y({url:e instanceof URL?e:R(e),mappings:t}),s)}}window.WebSocket=e}if(i){const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(s,i,n,a,r){const o=y({url:R(i),mappings:t});e.apply(this,[s,o,n,a,r])}}if(n){const e={attributeFilter:['src'],childList:!0,subtree:!0};new MutationObserver((function(e){for(const s of e)'attributes'===s.type&&'src'===s.attributeName?D(s.target,t):'childList'===s.type&&s.addedNodes.forEach((e=>{D(e,t),A(e,t)}))})).observe(window.document,e),window.document.querySelectorAll('[src]').forEach((e=>{D(e,t)}))}}}}var f;!function(t){t.AED="aed",t.AFN="afn",t.ALL="all",t.AMD="amd",t.ANG="ang",t.AOA="aoa",t.ARS="ars",t.AUD="aud",t.AWG="awg",t.AZN="azn",t.BAM="bam",t.BBD="bbd",t.BDT="bdt",t.BGN="bgn",t.BHD="bhd",t.BIF="bif",t.BMD="bmd",t.BND="bnd",t.BOB="bob",t.BOV="bov",t.BRL="brl",t.BSD="bsd",t.BTN="btn",t.BWP="bwp",t.BYN="byn",t.BYR="byr",t.BZD="bzd",t.CAD="cad",t.CDF="cdf",t.CHE="che",t.CHF="chf",t.CHW="chw",t.CLF="clf",t.CLP="clp",t.CNY="cny",t.COP="cop",t.COU="cou",t.CRC="crc",t.CUC="cuc",t.CUP="cup",t.CVE="cve",t.CZK="czk",t.DJF="djf",t.DKK="dkk",t.DOP="dop",t.DZD="dzd",t.EGP="egp",t.ERN="ern",t.ETB="etb",t.EUR="eur",t.FJD="fjd",t.FKP="fkp",t.GBP="gbp",t.GEL="gel",t.GHS="ghs",t.GIP="gip",t.GMD="gmd",t.GNF="gnf",t.GTQ="gtq",t.GYD="gyd",t.HKD="hkd",t.HNL="hnl",t.HRK="hrk",t.HTG="htg",t.HUF="huf",t.IDR="idr",t.ILS="ils",t.INR="inr",t.IQD="iqd",t.IRR="irr",t.ISK="isk",t.JMD="jmd",t.JOD="jod",t.JPY="jpy",t.KES="kes",t.KGS="kgs",t.KHR="khr",t.KMF="kmf",t.KPW="kpw",t.KRW="krw",t.KWD="kwd",t.KYD="kyd",t.KZT="kzt",t.LAK="lak",t.LBP="lbp",t.LKR="lkr",t.LRD="lrd",t.LSL="lsl",t.LTL="ltl",t.LVL="lvl",t.LYD="lyd",t.MAD="mad",t.MDL="mdl",t.MGA="mga",t.MKD="mkd",t.MMK="mmk",t.MNT="mnt",t.MOP="mop",t.MRO="mro",t.MUR="mur",t.MVR="mvr",t.MWK="mwk",t.MXN="mxn",t.MXV="mxv",t.MYR="myr",t.MZN="mzn",t.NAD="nad",t.NGN="ngn",t.NIO="nio",t.NOK="nok",t.NPR="npr",t.NZD="nzd",t.OMR="omr",t.PAB="pab",t.PEN="pen",t.PGK="pgk",t.PHP="php",t.PKR="pkr",t.PLN="pln",t.PYG="pyg",t.QAR="qar",t.RON="ron",t.RSD="rsd",t.RUB="rub",t.RWF="rwf",t.SAR="sar",t.SBD="sbd",t.SCR="scr",t.SDG="sdg",t.SEK="sek",t.SGD="sgd",t.SHP="shp",t.SLL="sll",t.SOS="sos",t.SRD="srd",t.SSP="ssp",t.STD="std",t.SVC="svc",t.SYP="syp",t.SZL="szl",t.THB="thb",t.TJS="tjs",t.TMT="tmt",t.TND="tnd",t.TOP="top",t.TRY="try",t.TTD="ttd",t.TWD="twd",t.TZS="tzs",t.UAH="uah",t.UGX="ugx",t.USD="usd",t.USN="usn",t.USS="uss",t.UYI="uyi",t.UYU="uyu",t.UZS="uzs",t.VEF="vef",t.VND="vnd",t.VUV="vuv",t.WST="wst",t.XAF="xaf",t.XAG="xag",t.XAU="xau",t.XBA="xba",t.XBB="xbb",t.XBC="xbc",t.XBD="xbd",t.XCD="xcd",t.XDR="xdr",t.XFU="xfu",t.XOF="xof",t.XPD="xpd",t.XPF="xpf",t.XPT="xpt",t.XSU="xsu",t.XTS="xts",t.XUA="xua",t.YER="yer",t.ZAR="zar",t.ZMW="zmw",t.ZWL="zwl"}(f||(f={}));const g={[f.AED]:2,[f.AFN]:2,[f.ALL]:2,[f.AMD]:2,[f.ANG]:2,[f.AOA]:2,[f.ARS]:2,[f.AUD]:2,[f.AWG]:2,[f.AZN]:2,[f.BAM]:2,[f.BBD]:2,[f.BDT]:2,[f.BGN]:2,[f.BHD]:3,[f.BIF]:0,[f.BMD]:2,[f.BND]:2,[f.BOB]:2,[f.BOV]:2,[f.BRL]:2,[f.BSD]:2,[f.BTN]:2,[f.BWP]:2,[f.BYR]:0,[f.BYN]:2,[f.BZD]:2,[f.CAD]:2,[f.CDF]:2,[f.CHE]:2,[f.CHF]:2,[f.CHW]:2,[f.CLF]:0,[f.CLP]:0,[f.CNY]:2,[f.COP]:2,[f.COU]:2,[f.CRC]:2,[f.CUC]:2,[f.CUP]:2,[f.CVE]:2,[f.CZK]:2,[f.DJF]:0,[f.DKK]:2,[f.DOP]:2,[f.DZD]:2,[f.EGP]:2,[f.ERN]:2,[f.ETB]:2,[f.EUR]:2,[f.FJD]:2,[f.FKP]:2,[f.GBP]:2,[f.GEL]:2,[f.GHS]:2,[f.GIP]:2,[f.GMD]:2,[f.GNF]:0,[f.GTQ]:2,[f.GYD]:2,[f.HKD]:2,[f.HNL]:2,[f.HRK]:2,[f.HTG]:2,[f.HUF]:2,[f.IDR]:2,[f.ILS]:2,[f.INR]:2,[f.IQD]:3,[f.IRR]:2,[f.ISK]:0,[f.JMD]:2,[f.JOD]:3,[f.JPY]:0,[f.KES]:2,[f.KGS]:2,[f.KHR]:2,[f.KMF]:0,[f.KPW]:2,[f.KRW]:0,[f.KWD]:3,[f.KYD]:2,[f.KZT]:2,[f.LAK]:2,[f.LBP]:2,[f.LKR]:2,[f.LRD]:2,[f.LSL]:2,[f.LTL]:2,[f.LVL]:2,[f.LYD]:3,[f.MAD]:2,[f.MDL]:2,[f.MGA]:2,[f.MKD]:2,[f.MMK]:2,[f.MNT]:2,[f.MOP]:2,[f.MRO]:2,[f.MUR]:2,[f.MVR]:2,[f.MWK]:2,[f.MXN]:2,[f.MXV]:2,[f.MYR]:2,[f.MZN]:2,[f.NAD]:2,[f.NGN]:2,[f.NIO]:2,[f.NOK]:2,[f.NPR]:2,[f.NZD]:2,[f.OMR]:3,[f.PAB]:2,[f.PEN]:2,[f.PGK]:2,[f.PHP]:2,[f.PKR]:2,[f.PLN]:2,[f.PYG]:0,[f.QAR]:2,[f.RON]:2,[f.RSD]:2,[f.RUB]:2,[f.RWF]:0,[f.SAR]:2,[f.SBD]:2,[f.SCR]:2,[f.SDG]:2,[f.SEK]:2,[f.SGD]:2,[f.SHP]:2,[f.SLL]:2,[f.SOS]:2,[f.SRD]:2,[f.SSP]:2,[f.STD]:2,[f.SVC]:2,[f.SYP]:2,[f.SZL]:2,[f.THB]:2,[f.TJS]:2,[f.TMT]:2,[f.TND]:3,[f.TOP]:2,[f.TRY]:2,[f.TTD]:2,[f.TWD]:2,[f.TZS]:2,[f.UAH]:2,[f.UGX]:0,[f.USD]:2,[f.USN]:2,[f.USS]:2,[f.UYI]:0,[f.UYU]:2,[f.UZS]:2,[f.VEF]:2,[f.VND]:0,[f.VUV]:0,[f.WST]:2,[f.XAF]:0,[f.XAG]:0,[f.XAU]:0,[f.XBA]:0,[f.XBB]:0,[f.XBC]:0,[f.XBD]:0,[f.XCD]:2,[f.XDR]:0,[f.XFU]:0,[f.XOF]:0,[f.XPD]:0,[f.XPF]:0,[f.XPT]:0,[f.XSU]:0,[f.XTS]:0,[f.XUA]:0,[f.YER]:2,[f.ZAR]:2,[f.ZMW]:2,[f.ZWL]:2};const S=/\{([a-z]+)\}/g,w='/.proxy';function A(t,e){t.hasChildNodes()&&t.childNodes.forEach((t=>{D(t,e),A(t,e)}))}function D(t,e){if(t instanceof HTMLElement&&t.hasAttribute('src')){const s=t.getAttribute('src'),i=R(s??'');if(i.host===window.location.host)return;if('script'===t.tagName.toLowerCase())!function(t,{url:e,mappings:s}){const i=y({url:e,mappings:s});if(e.toString()!==i.toString()){const i=document.createElement(t.tagName);i.innerHTML=t.innerHTML;for(const e of t.attributes)i.setAttribute(e.name,e.value);i.setAttribute('src',y({url:e,mappings:s}).toString()),t.after(i),t.remove()}}(t,{url:i,mappings:e});else{const n=y({url:i,mappings:e}).toString();n!==s&&t.setAttribute('src',n)}}}function y({url:t,mappings:e}){const s=new URL(t.toString());!s.hostname.includes('discordsays.com')&&!s.hostname.includes('discordsez.com')||s.pathname.startsWith(w)||(s.pathname=w+s.pathname);for(const i of e){const e=b({originalURL:s,prefix:i.prefix,target:i.target,prefixHost:window.location.host});if(null!=e&&e?.toString()!==t.toString())return e}return s}function R(t,e=window.location.protocol,s=window.location.host){return new URL(t,`${e}//${s}`)}function b({originalURL:t,prefix:e,prefixHost:s,target:i}){const n=new URL(`https://${i}`),a=function(t){const e=t.replace(S,((t,e)=>`(?<${e}>[\\w-]+)`));return new RegExp(`${e}(/|$)`)}(n.host.replace(/%7B/g,'{').replace(/%7D/g,'}')),r=t.toString().match(a);if(null==r)return t;const o=new URL(t.toString());return o.host=s,o.pathname=e.replace(S,((t,e)=>{const s=r.groups?.[e];if(null==s)throw new Error('Misconfigured route.');return s})),o.pathname+='/'===o.pathname?t.pathname.slice(1):t.pathname,!o.hostname.includes('discordsays.com')&&!o.hostname.includes('discordsez.com')||o.pathname.startsWith(w)||(o.pathname=w+o.pathname),o.pathname=o.pathname.replace(n.pathname,''),t.pathname.endsWith('/')&&!o.pathname.endsWith('/')&&(o.pathname+='/'),o}class E{#t;#n;#a=new Set(["undefined"!=typeof window?window.location.origin:"","https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]);constructor(t,e){this.#t=t,this.#n=e,this.receive=this.receive.bind(this),this.authentication=this.authentication.bind(this)}parseMajorMobileVersion(t){if(t&&t.includes("."))try{return parseInt(t.split(".")[0])}catch{return-1}return-1}async receive(s){if(!this.#a.has(s.origin))return;const i=s.data,c=i?.[0];switch(c){case e.Handshake:case e.Hello:case e.Close:break;case e.Frame:{if(this.#t.stateCode==t.Stable){await this.#t.appSenderPromise;const t={hirpc_state:this.#t.stateCode,rpc_message:i};return void this.#t.appSender(JSON.stringify(t))}const e=window.dso_build_variables,s=i?.[1],c=s?.data,h=s?.evt,d=s?.cmd;if(d==r.DISPATCH&&h==o.READY){this.#t.multiEvent.ready=this.#r(c),e.DISABLE_CONSOLE_LOG_OVERRIDE||this.#o();try{const t=e.MAPPINGS,s=e.PATCH_URL_MAPPINGS_CONFIG;t.length>0&&(e.DISABLE_INFO_LOGS||n(`Patching url mappings... (${t.length})`),this.#n.patchUrlMappings(t,s))}catch(t){a(`Something went wrong patching the URL mappings: ${t}`)}e.DISABLE_INFO_LOGS||n("Connected to RPC!"),this.#t.dispatchReady()}else d==r.AUTHORIZE&&h!=o.ERROR?this.#t.multiEvent.authorize=this.#r(c):d==r.AUTHENTICATE&&(this.#t.multiEvent.authenticate=this.#r(c),this.#t.dispatchAuth())}}}async authentication(s){if(!this.#a.has(s.origin))return;const i=window.dso_build_variables,c=s.data,h=c?.[0],d=c?.[1],l=d?.data,p=d?.evt,u=d?.cmd;if(h==e.Frame)switch(u){case r.AUTHORIZE:{if(p==o.ERROR)return this.#t.stateCode=t.Errored,window.removeEventListener("message",this.receive),window.removeEventListener("message",this.authentication),void this.send(e.Close,{code:1e3,message:"User unauthorized scopes",nonce:this.getNonce()});i.DISABLE_INFO_LOGS||n("Authorized!");const s=i.TOKEN_REQUEST_PATH,c=i.SERVER_REQUEST;let h={code:l.code};if(""!=c){const t=JSON.parse(c);delete t.code,h={code:l.code,...t}}const d=await fetch(`/.proxy${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),u=await d.json();if(!u.token)return void a("The server JSON response didn't include a 'token' field");this.#t.multiEvent.response=JSON.stringify(u),this.send(e.Frame,{cmd:r.AUTHENTICATE,nonce:this.getNonce(),args:{access_token:u.token}});break}case r.AUTHENTICATE:window.removeEventListener("message",this.authentication),i.DISABLE_INFO_LOGS||n("Authenticated!")}}send(t,e){const s=window.parent.opener??window.parent,i=document.referrer?document.referrer:"*";s.postMessage([t,e],i)}getNonce(){const t=new Array(36);for(let e=0;e<36;e++)t[e]=Math.floor(16*Math.random());return t[14]=4,t[19]=t[19]&=-5,t[19]=t[19]|=8,t[8]=t[13]=t[18]=t[23]="-",t.map((t=>t.toString(16))).join("")}#r(t){return JSON.stringify(t,((t,e)=>"bigint"==typeof e?e.toString():e))}#o(){const t=(t,s)=>{this.send(e.Frame,{cmd:"CAPTURE_LOG",nonce:this.getNonce(),args:{level:t,message:s}})};["log","warn","debug","info","error"].forEach((e=>{const s=console[e],i=console;s&&(console[e]=function(){const n=[].slice.call(arguments),a=""+n.join(" ");t(e,a),s.apply(i,n)})}))}}class P{#t;#c;#n;#h;constructor(){this.#t=new u,this.#c=new p(this.#t),this.#n=new m,this.#h=new E(this.#t,this.#n),this.#t.readyPromise=new Promise((t=>{this.#t.dispatchReady=t})),this.#t.authPromise=new Promise((t=>{this.#t.dispatchAuth=t})),this.#t.appSenderPromise=new Promise((t=>{this.#t.dispatchAppSender=t})),"undefined"!=typeof window&&window.addEventListener("message",this.#h.receive)}async load(e=1){if(this.#t.loaded)throw new Error("hiRPC Module already loaded");if("undefined"==typeof window)throw this.#t.stateCode=t.Unfunctional,new Error("Cannot load hiRPC Module outside of a web environment");this.#t.loaded=!0,this.#t.maxAccessCount=e;(await this.getBuildVariables()).DISABLE_INFO_LOGS||this.#d();if("true"==sessionStorage.getItem("dso_outside_discord"))return void(this.#t.stateCode=t.OutsideDiscord);const s=this.getQueryObject();if(!s.frame_id||!s.instance_id||!s.platform)return void(this.#t.stateCode=t.OutsideDiscord);const i=sessionStorage.getItem("dso_connected");if("false"==i||null==i)await this.#l();else{if("true"!=i)throw new Error(`Invalid session storage item: { dso_connected: ${i} }`);this.#t.dispatchReady()}const n=sessionStorage.getItem("dso_authenticated");if("false"==n||null==n)await this.#p();else{if("true"!=n)throw new Error(`Invalid session storage item: { dso_authenticated: ${n} }`);this.#t.dispatchAuth()}this.#t.stateCode=t.Stable}async#l(){const t=this.getQueryObject(),s=this.getBuildVariables(),i=s.CLIENT_ID,a=s.DISABLE_INFO_LOGS,r=this.#h.parseMajorMobileVersion(t.mobile_app_version),o={v:1,encoding:"json",client_id:i,frame_id:t.frame_id};(t.platform===c.DESKTOP||r>=250)&&(o.sdk_version=l),a||n("Connecting..."),this.#h.send(e.Handshake,o),await this.#t.readyPromise}async#p(){window.addEventListener("message",this.#h.authentication);const t=this.getBuildVariables();this.#h.send(e.Frame,{cmd:r.AUTHORIZE,nonce:this.getNonce(),args:{client_id:t.CLIENT_ID,scope:t.OAUTH_SCOPES,response_type:"code",prompt:"none",state:""}}),await this.#t.authPromise}#d(){n(`hiRPC! version ${h}`)}getBuildVariables(){if("object"==typeof window.dso_build_variables)return window.dso_build_variables;if("object"==typeof window.Dissonity.BuildVariables)return window.dso_build_variables=new window.Dissonity.BuildVariables.default,window.dso_build_variables;throw a("Unable to access build variables. Import them through <import map>/dissonity_build_variables.js"),this.#t.stateCode=t.Errored,new Error("Unable to access build variables. Import them through <import map>/dissonity_build_variables.js")}patchUrlMappings(t,e,s){this.#c.verifyHash(t)&&this.#n.patchUrlMappings(e,s)}formatPrice(t,e,s){if(this.#c.verifyHash(t))return this.#n.formatPrice(e,s)}getQueryObject(){const t=window.location.search.includes("?")?window.location.search.replace("?","").split("&"):window.parent.location.search.replace("?","").split("&"),e={};if(0!=t.length)for(let s=0;s<t.length;s++)e[t[s].split("=")[0]]=t[s].split("=")[1];return e}getNonce(){return this.#h.getNonce()}getVersions(){return{embedded_app_sdk:l,hirpc:h}}async requestHash(){return this.#c.requestHash()}async sendToRpc(t,s=e.Frame,i){this.#c.verifyHash(t)&&(await this.#t.readyPromise,this.#h.send(s,i))}sendToJs(t,e,s){if(!this.#c.verifyAppHash(t))return;if(e==d)throw new Error(`Cannot send message through the "${d}" channel`);const i={channel:e,data:s};for(const t of this.#t.appListeners)t(i)}async sendToApp(t,e,s){if(this.#c.verifyAccessHash(t)){if(e==d)throw new Error(`Cannot send message through the "${d}" channel`)}else if(!this.#c.verifyAppHash(t))return;await this.#t.appSenderPromise;const i={hirpc_state:this.#t.stateCode,hirpc_message:{channel:e,data:s}};this.#t.appSender(JSON.stringify(i))}addAppListener(t,e){this.#c.verifyHash(t)&&this.#t.appListeners.push(e)}removeAppListener(t,e){if(!this.#c.verifyHash(t))return;const s=this.#t.appListeners.indexOf(e);-1!=s&&this.#t.appListeners.splice(s,1)}lockHashAccess(){this.#c.lock()}async openDownwardFlow(t){if(null!=this.#t.appSender)throw new Error("An app sender has already been defined");this.#c.lock(),this.#t.appSender=t;const e=sessionStorage.getItem("dso_outside_discord");"true"!=e&&await this.#t.authPromise;const s={raw_multi_event:"true"!=e?this.#t.multiEvent:null,hash:await this.#c.generateHash(!0)},i={hirpc_state:this.#t.stateCode,hirpc_message:{channel:d,data:s,opening:!0}};this.#t.appSender(JSON.stringify(i)),this.#t.dispatchAppSender()}closeDownwardFlow(t){this.#c.verifyHash(t)&&null!=this.#t.appSender&&(this.#t.appSenderPromise=new Promise((t=>{this.#t.dispatchAppSender=t})),this.#t.appSender=null)}}(self.Dissonity=self.Dissonity||{}).HiRpc=i})();